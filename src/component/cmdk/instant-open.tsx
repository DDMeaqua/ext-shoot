/* eslint-disable react/display-name */

import React, { SVGProps } from 'react';
import { Command } from 'cmdk';

const PREFIX = 'InstantOpen';
function LinkIcon(props: SVGProps<SVGSVGElement>) {
	return (
		<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 32 32" {...props}><g fill="none"><g filter="url(#f887id7)"><rect width="7.513" height="12.209" fill="url(#f887id0)" rx="3.757" transform="scale(-1 1)rotate(-45 20.31 29.04)"></rect><rect width="7.513" height="12.209" fill="url(#f887id1)" rx="3.757" transform="scale(-1 1)rotate(-45 20.31 29.04)"></rect><rect width="7.513" height="12.209" fill="url(#f887id2)" rx="3.757" transform="scale(-1 1)rotate(-45 20.31 29.04)"></rect></g><rect width="7.513" height="12.209" fill="url(#f887idb)" rx="3.757" transform="scale(-1 1)rotate(-45 20.31 29.04)"></rect><path fill="url(#f887id3)" fillRule="evenodd" d="M19.094 23.797c-5.972 0-10.813-4.841-10.813-10.813c0-5.971 4.841-10.812 10.813-10.812c5.971 0 10.812 4.84 10.812 10.812c0 5.972-4.84 10.813-10.812 10.813m0-1.75a9.063 9.063 0 1 1 0-18.125a9.063 9.063 0 0 1 0 18.125" clipRule="evenodd"></path><g filter="url(#f887id8)"><path fill="url(#f887id4)" fillRule="evenodd" d="M19.094 23.552c-5.837 0-10.568-4.731-10.568-10.568c0-5.836 4.731-10.568 10.568-10.568c5.836 0 10.568 4.732 10.568 10.568c0 5.837-4.732 10.568-10.568 10.568m0-1.71a8.858 8.858 0 1 1 0-17.715a8.858 8.858 0 0 1 0 17.715" clipRule="evenodd"></path><path fill="url(#f887idc)" fillRule="evenodd" d="M19.094 23.552c-5.837 0-10.568-4.731-10.568-10.568c0-5.836 4.731-10.568 10.568-10.568c5.836 0 10.568 4.732 10.568 10.568c0 5.837-4.732 10.568-10.568 10.568m0-1.71a8.858 8.858 0 1 1 0-17.715a8.858 8.858 0 0 1 0 17.715" clipRule="evenodd"></path></g><g filter="url(#f887id9)"><circle r="9.295" fill="url(#f887id5)" transform="matrix(-1 0 0 1 19.094 12.984)"></circle></g><g filter="url(#f887ida)"><circle r="9.063" fill="#64D0EA" transform="matrix(-1 0 0 1 19.094 12.984)"></circle></g><ellipse cx="23.323" cy="9.13" fill="url(#f887id6)" rx="1.651" ry="2.033" transform="rotate(-38.896 23.323 9.13)"></ellipse><defs><linearGradient id="f887id0" x1=".63" x2="4.961" y1="10.364" y2="1.834" gradientUnits="userSpaceOnUse"><stop stopColor="#A0659C"></stop><stop offset="1" stopColor="#895792"></stop></linearGradient><linearGradient id="f887id1" x1="3.745" x2="3.757" y1=".53" y2="4.817" gradientUnits="userSpaceOnUse"><stop stopColor="#6C3B74"></stop><stop offset="1" stopColor="#845590" stopOpacity="0"></stop></linearGradient><linearGradient id="f887id2" x1="7.612" x2="2.464" y1="8.331" y2="8.176" gradientUnits="userSpaceOnUse"><stop offset=".115" stopColor="#703D7A"></stop><stop offset="1" stopColor="#703D7A" stopOpacity="0"></stop></linearGradient><linearGradient id="f887id3" x1="19.094" x2="19.094" y1="2.172" y2="23.797" gradientUnits="userSpaceOnUse"><stop offset=".379" stopColor="#344A7D"></stop><stop offset=".633" stopColor="#785790"></stop><stop offset=".837" stopColor="#785790"></stop><stop offset="1" stopColor="#9872A2"></stop></linearGradient><linearGradient id="f887id4" x1="19.094" x2="19.094" y1="2.416" y2="23.552" gradientUnits="userSpaceOnUse"><stop stopColor="#475890"></stop><stop offset="1" stopColor="#7A4D87"></stop></linearGradient><linearGradient id="f887id5" x1="9.295" x2="9.295" y1="0" y2="18.59" gradientUnits="userSpaceOnUse"><stop stopColor="#204083"></stop><stop offset="1" stopColor="#523573"></stop></linearGradient><linearGradient id="f887id6" x1="23.323" x2="23.323" y1="7.097" y2="11.163" gradientUnits="userSpaceOnUse"><stop stopColor="#DCDBF2"></stop><stop offset=".209" stopColor="#DCDBF2" stopOpacity=".848"></stop><stop offset="1" stopColor="#DCDBF2" stopOpacity="0"></stop></linearGradient><filter id="f887id7" width="11.833" height="12.083" x="1.197" y="18.861" colorInterpolationFilters="sRGB" filterUnits="userSpaceOnUse"><feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dx="-1" dy="1"></feOffset><feGaussianBlur stdDeviation="1.5"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix values="0 0 0 0 0.4 0 0 0 0 0.239216 0 0 0 0 0.439216 0 0 0 1 0"></feColorMatrix><feBlend in2="shape" result="effect1_innerShadow_18_20475"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="-.25"></feOffset><feGaussianBlur stdDeviation=".375"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix values="0 0 0 0 0.639216 0 0 0 0 0.490196 0 0 0 0 0.643137 0 0 0 1 0"></feColorMatrix><feBlend in2="effect1_innerShadow_18_20475" result="effect2_innerShadow_18_20475"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation=".75"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix values="0 0 0 0 0.333333 0 0 0 0 0.27451 0 0 0 0 0.380392 0 0 0 1 0"></feColorMatrix><feBlend in2="effect2_innerShadow_18_20475" result="effect3_innerShadow_18_20475"></feBlend></filter><filter id="f887id8" width="21.736" height="21.736" x="8.226" y="2.116" colorInterpolationFilters="sRGB" filterUnits="userSpaceOnUse"><feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_18_20475" stdDeviation=".15"></feGaussianBlur></filter><filter id="f887id9" width="18.99" height="18.99" x="9.599" y="3.489" colorInterpolationFilters="sRGB" filterUnits="userSpaceOnUse"><feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feGaussianBlur result="effect1_foregroundBlur_18_20475" stdDeviation=".1"></feGaussianBlur></filter><filter id="f887ida" width="18.125" height="19.275" x="10.031" y="3.772" colorInterpolationFilters="sRGB" filterUnits="userSpaceOnUse"><feFlood floodOpacity="0" result="BackgroundImageFix"></feFlood><feBlend in="SourceGraphic" in2="BackgroundImageFix" result="shape"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="1"></feOffset><feGaussianBlur stdDeviation="1"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix values="0 0 0 0 0.168627 0 0 0 0 0.603922 0 0 0 0 0.956863 0 0 0 1 0"></feColorMatrix><feBlend in2="shape" result="effect1_innerShadow_18_20475"></feBlend><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset dy="-.15"></feOffset><feGaussianBlur stdDeviation=".15"></feGaussianBlur><feComposite in2="hardAlpha" k2="-1" k3="1" operator="arithmetic"></feComposite><feColorMatrix values="0 0 0 0 0.137255 0 0 0 0 0.607843 0 0 0 0 0.984314 0 0 0 1 0"></feColorMatrix><feBlend in2="effect1_innerShadow_18_20475" result="effect2_innerShadow_18_20475"></feBlend></filter><radialGradient id="f887idb" cx="0" cy="0" r="1" gradientTransform="rotate(92.442 1.99 1.727)scale(2.33336 5.42286)" gradientUnits="userSpaceOnUse"><stop stopColor="#2F1A3D"></stop><stop offset="1" stopColor="#532D64" stopOpacity="0"></stop></radialGradient><radialGradient id="f887idc" cx="0" cy="0" r="1" gradientTransform="matrix(0 -5.125 9.53123 .00002 19.094 7.406)" gradientUnits="userSpaceOnUse"><stop offset=".704" stopColor="#566298"></stop><stop offset=".787" stopColor="#566298" stopOpacity="0"></stop></radialGradient></defs></g></svg>
	);
}

function normalizeLink(link: string): string {
	let normalizedLink = link.trim();
	if (!link.startsWith('http://') && !link.startsWith('https://')) {
		link = `https://www.google.com/search?q=${encodeURIComponent(link)}`;
		return link;
	}
	const url = new URL(link);
	normalizedLink = url.href;
	return normalizedLink;
}


const Search = React.forwardRef(({ search }: { search: string }, ref) => {
	React.useImperativeHandle(ref, () => ({
		onSearch,
	}));

	const onSearch = () => {
		console.log('onSearch');
		const normalizedLink = normalizeLink(search);
		window.open(normalizedLink);
	};
	return <Command.Item
		key={`${PREFIX}${search}`}
		value={`${PREFIX}${search}`}
		keywords={['open', search]}
		onSelect={() => {
			onSearch();
		}}>
		<LinkIcon></LinkIcon>
		{`Instant Open`}
		<span cmdk-raycast-meta="" style={{ flexShrink: 0 }}> Command</span>
	</Command.Item>;
});
export default Search;